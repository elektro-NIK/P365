{% extends "base/base.html" %}
{% load leaflet_tags %}
{% load staticfiles %}

{% block content %}
    <div class="row">
        <div id="msg-wrong"></div>
        {% leaflet_map "mainmap" callback="window.map_init_basic" %}
    </div>
{% endblock %}

{% block css %}
    {% leaflet_css %}
    <link href="{% static 'css/map.css' %}" rel="stylesheet" media="screen">
{% endblock %}

{% block js %}
    {% leaflet_js %}
    <script src="{% static 'js/msg_wrong.js' %}"></script>
    <script>
        var bounds;

        function parseData (map, data) {
            var json = JSON.parse(data);
            b = L.geoJson(json, {
                onEachFeature: function (feature, layer) {
                    layer.bindPopup('<p>' + '<b>' + feature.properties.name + '</b>' +
                                    '<br>' + feature.properties.description, '</p>');
                }
            });
            b.addTo(map);
            bounds ? bounds.extend(b.getBounds()) : bounds = b.getBounds()
            bounds.isValid() ? map.fitBounds(bounds) : {}
        }

        function map_init_basic (map, options) {
            $.getJSON("{% url 'geojson_tracks' %}")
            .done(function(data) {parseData(map, data)})
            .fail(function()     {setErrorMsg()});

            $.getJSON("{% url 'geojson_pois' %}")
            .done(function(data) {parseData(map, data)})
            .fail(function()     {setErrorMsg()});
        }
    </script>
{% endblock %}
